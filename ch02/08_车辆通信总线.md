
随着线控系统数量的增多，各线控系统不可能独立工作，例如转向和制动就需要进行协调控制，实现资源共享减少延迟，以满足不同情况下对转向能力的制动效能的要求。因此对`通信时间的离散性和延时性`提出了更高的要求。传统基于事件的网络通信协议当几个信息同时发送时，往往会造成网络交通拥挤，虽然可以通过仲裁机制来保证这些信息以既定的优先级发送，但往往会造成某些信息的延迟。目前基于`时间触发`的网络协议已经被汽车企业广泛采用，在明确定义的时间点执行操作，即各线控系统同步之后，每个系统在一个特定的时间窗口传送自己的信息，而不必再去竞争总线，提高了数据的传输速率和可靠性。

目前，车用总线技术被美国汽车工程师协会(SAE)下属的汽车网络委员会按照协议特性分为 A、B、C、D 4 类。

| 类别 | 对象 | 位速率(Kb/s) | 应用范围 | 主要总线 |
|:----|:----|:-------------|:-------|:--------|
| A   | 面向传感器执行器的低速网络 | 1~10 | 电动门窗、座椅调节、灯光照明等控制 | TTP/A、LIN |
| B   | 面向独立模块间数据共享的中速网络 | 10~125 | 电子车辆信息中心、故障诊断、仪表显示、安全气囊等系统 | CAN |
| C   | 面向高速、实时闭环控制的多路传输网 | 125~1000 | 悬架控制、牵引控制、发动机控制、ABS 等系统 | CAN、TTP/C、FlexRay |
| D   | 未定义 | >1000 | 汽车导航、多媒体娱乐等系统 | MOST/1394 |


### 本地互联网络

在 A 级标准中，LIN 总线应用比较广泛。本地互联网络(LIN)是面向汽车低端分布式应用的具有低成本、低速串行等特点的总线形式。

LIN 总线的`工作原理`是采用一主多从的模式，一个主节点可以支持 16 个从节点，在主从设备之间只需要一根电压为 12V 的信号线。这种主要面向"传感器/执行器控制"的低速网络，其最高传输速率可达 20Kb/s，应用于电动门窗、座椅调节、灯光照明等控制系统。通过 CAN 网关，LIN 网络还可以和汽车的其他系统进行信息交换，实现更丰富的功能。

LIN Bus 访问控制方式如下。

![](img/LIN访问控制.jpg)

LIN 包含一个宿主节点(Master)和一个或多个从属节点(Slave)。所有节点都包含一个被分解为发送和接收任务的从属通信任务，而宿主节点还包含一个附加的宿主发送任务。在实时 LIN 中，通信总是由宿主任务发起的。除了宿主节点的命名外，LIN 网络中的节点不使用有关系统设置的任何信息。可以在不要求其他从属节点硬件和软件的情况下向 LIN 中增加节点。宿主节点发送一个包含同步中断、同步字节和消息识别码的消息报头，从属任务在收到和过滤识别码后被激活并开始消息响应的传输。响应包含 2 个、4 个或 8 个数字字节和一个校验和(checksum)字节。报头和响应部分组成一个消息帧。LIN 总线上的所有通信都由主机节点中的主机任务发起，主机任务根据进度表确定当前的通信内容，发送相应的帧头，并为报文帧分配帧通道。总线上的从机节点接收帧头之后，`通过解读标识确定自己是否应该对当前通信做出响应、做出何种响应`。基于这种`报文过滤`的方式，LIN 可实现多种数据传输模式，且一个报文帧可以同时被多个节点接收利用。

### 控制器局域网络

控制器局域网(Controller Area Network,CAN)总线是一种用于实时应用的串行通信协议总线，它可以使用双绞线来传输信号。CAN 总线是一种多主方式的串行通信总线，基本设计规范要求有高位速率、高抗电子干扰性，并且能够检测出产生的任何错误。

汽车总线系统的研究与发展可以为分为 3 个阶段。研究汽车的基本控制系统(也称舒适总线)，如照明、电动车窗、中央集控锁等；研究汽车的主要控制系统(也称动力总线)，如电喷ECU控制系统、ABS系统、自动变速锁等；研究汽车各电子控制系统之间的综合、实时控制和信息反馈。在汽车上主要采用两种 CAN 总线，一种用于驱动系统的高速 CAN、速率一般可达到 500Kb/s，最高可达 1000Kb/s；另一种用于车身系统低速 CAN，速率是 100Kb/s。驱动系统 CAN(也称动力CAN)主要连接对象是发动机控制器(ECU)、ABS控制器、安全气囊控制器等，车身CAN(也称舒适CAN)主要连接和控制汽车内外部照明、灯光信号、空调、刮水电机、中央门锁与防盗控制开关、故障诊断系统、组合仪表及其他辅助电器等。

CAN 总线具有以下特点:
- 具有实时性强、传输距离较远、抗电磁干扰能力强、成本低等优点
- 采用双线串行通信方式，检错能力强，可在高噪声干扰环境中工作
- 具有优先权和仲裁功能，多个控制模块通过 CAN 控制器挂到 CAN-bus 上，形成多主机局部网络
- 可根据报文的 ID 决定接收或屏蔽该报文
- 具备可靠的错误处理和检错机制
- 发送的信息遭到破坏后，可自动重发
- 节点在错误严重的情况下具有自动退出总线的功能
- 报文不包含源地址或目标地址，仅用标志符来指示功能信息、优先级信息

CAN 采用了 3 层模型: 物理层、数据链路层和应用层。支持的拓扑结构为总线型。传输介质为双绞线、同轴电缆和光纤等。采用双绞线通信时，速率可达 1Mb/s，节点数可达 110。

CAN 的通信采用`多主竞争`方式结构: 网络上任意节点均可以在任意时刻主动地向网络上其他节点发送信息，而不分主从，即当总线空闲时，各个节点都有权使用网络。在发生冲突时，采用非破坏性总线优先仲裁技术；当几个节点同时向网络发送消息时，运用逐位仲裁原则，借助帧中开始部分的表示符，优先级低的节点主动停止发送数据，而优先级高的节点可不受影响地继续发送信息，从而有效地避免了总线冲突，使信息和时间均无损失。

CAN 的通信协议主要由 CAN 总线控制器完成。CAN 控制器主要由实现 CAN 总线协议部分和微控制器接口部分电路组成。通过简单的连接即可完成 CAN 协议的物理层和数据链路层的所有功能，应用层功能由微控制器完成。CAN 总线上的节点既可以是基于微控制器的智能节点，也可以是具有 CAN 接口的 I/O 器件。

CAN 总线属于`现场总线`(意思应该是非开放式网络)的范畴，CAN 总线系统的一般组成模式如下图所示。

![](img/CAN总线系统组成.jpg)

为了解决总线上信息增多产生的信息延迟现象，博世在标准 CAN 协议扩展了支持时间触发的协议——TTCAN。由于标准 CAN 在汽车领域的成功，TTCAN 或许也将成为未来线控领域广泛应用的总线协议。

### 高速容错网络协议

高速容错网络协议(FlexRay)是一种用于汽车的高速、可确定性的，具备故障容错能力的总线技术。FlexRay 总线数据收发既支持`时间触发`访问方式，也支持`事件触发`访问方式。利用时间触发通信时，网络中的各个节点预先知道彼此将要进行通信的时间，接收器提前知道报文到达的时间，报文在总线上的时间可以预测出来，FlexRay 协议也可以确保将信息延迟和抖动降至最低，尽可能保持传输的同步与可预测。这对需要持续及高速性能的应用(如线控制动、线控转向等)来说是非常重要的。

FlexRay 总线将车载网络中的独立完成相应功能的控制单元视为节点，主要有电源供给系统(Power Supply)、主处理器(Host)、固化FlexRay通信控制器(Communication Controller)、可选的总线监控器(Bus Guardian)和总线驱动器(Bus Driver)等。如下图所示。

![](img/FlexRay通信架构.jpg)

主处理器提供和产生数据，并通过 FlexRay 通信控制器传送出去。其中 BD 和 BG 的个数对应于通道数，与通信控制器和微处理器相连。总线监控逻辑必须独立于其他的通信控制器。总线驱动器连接着通信控制器和总线，或是连接总线监控器和总线。节点的两个通信过程如下:
- 发送数据: Host 将有效的数据送给 CC，在 CC 中进行编码，形成数据位流，通过 BD 发送到相应的通道上。
- 接收数据: 在某一时刻，由 BD 访问栈，将数据位流送到 CC 进行解码，将数据部分由 CC 传送给 Host 。

FlexRay 的拓扑主要分为 3 种: 总线状、星状、混合状。通常，FlexRay 节点可以支持两个信道，因而可以分为单信道和双信道两种系统。在双信道系统中，不是所有节点都必须与两个信道连接。

当 FlexRay 总线通信过程中出现数据错误时，该周期里接收到的所有数据都会被丢弃，但没有重发机制。所有节点会继续进行下一个周期的通信。FlexRay 同样也有错误计数器，当一个节点发送接收错误过多时会被踢出总线。

### 车载以太网

车载以太网是在民用以太网的基础上，改变了物理接口的电气特性，并结合车载网络需求专门定制新标准的以太网络。

目前的技术而言，车载以太网为主干、CAN 作为子系统的通信方式既保留了 CAN 实时、安全的特性，又能够提升通信速度与传输距离，同时还保证了成本的控制，很有可能广泛地应用到自动驾驶车辆车载通信中。

CAN 总线与车载以太网的对比

| 总线类型 | CAN 总线 | 以太网 |
|:--------|:--------|:------|
| 传输速率 | 5Kb/s~1Mb/s | 10Mb/s、100Mb/s等 |
| 容错机制 | 信号分优先级、采取非破坏仲裁技术、实时性好、稳定性高 | 带有冲突检测的载波侦听多路访问协议，实时性差；超时重发机制，故障易扩散 |
| 成本核算 | 仅需两根线材即可完成挂接 | 需经过交换机，增加物料 |
| 网络安全 | 专用现场总线，较为安全 | 开放式网络，易被攻击 |

